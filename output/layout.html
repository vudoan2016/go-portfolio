<!DOCTYPE html>
<html lang="en">
  <h1>{{.Date}}</h1>
  <head>
    <script
      type="text/javascript"
      src="https://www.gstatic.com/charts/loader.js"
    ></script>
    <script type="text/javascript">
      google.charts.load("current", { packages: ["corechart"] });
      google.charts.load('current', { packages: ['table']});
      google.charts.setOnLoadCallback(drawChart);
      google.charts.setOnLoadCallback(drawTable);

      function createChartData(positions) {
        var array = [];
        var header = ["Name", "Weight"];
        array.push(header);

        for (var i = 0; i < positions.length; i++) {
          var row = [];
          row.push(positions[i].Name);
          row.push(positions[i].Weight);
          array.push(row);
        }
        var data = google.visualization.arrayToDataTable(array);
        return data;
      }

      function drawOneChart(title, id, data) {
        var options = {
          title: title
        };

        var chart = new google.visualization.PieChart(
          document.getElementById(id)
        );

        chart.draw(data, options);
      }

      function drawChart() {
        drawOneChart("Components", "preTaxHoldings", createChartData({{ .Pretaxes.Positions }}));
        drawOneChart("Components", "postTaxHoldings", createChartData({{ .Posttaxes.Positions }}));
        drawOneChart("Sectors", "preTaxSectors", createChartData({{ .Pretaxes.Sectors }}));
        drawOneChart("Sectors", "postTaxSectors", createChartData({{ .Posttaxes.Sectors }}));
      }

      function createTableData(positions, value, gain, percentage) {
        var array = [];
        var header = ["Name", "Today", "Value", "Weight", "Gain", "Percentage", "Shares", 
                      "Purchase Price", "Purchase Date", "Sale Price", "Sale Date", "Forward PE", 
                      "Forward EPS", "Trailing Annual Dividend Yield"];
        array.push(header);

        for (var i = 0; i < positions.length; i++) {
          var row = [];
          row.push(<a href="https://finance.yahoo.com/quote/positions[i].Name"></a>);
          row.push(positions[i].Price);
          row.push(positions[i].Value);
          row.push(positions[i].Weight);
          row.push(positions[i].Gain);
          row.push(positions[i].Percentage);
          row.push(positions[i].shares); // can't use Shares 
          row.push(positions[i].purchaseprice);
          row.push(positions[i].buydate);
          row.push(positions[i].saleprice);
          row.push(positions[i].saledate);
          row.push(positions[i].ForwardPE);
          row.push(positions[i].ForwardEPS);
          row.push(positions[i].TrailingAnnualDividendYield);
          array.push(row);
        }
        var row = []
        row.push("Summary");
        row.push(""); // Price
        row.push(value);
        row.push(""); // Weight
        row.push(gain);
        row.push(percentage);
        row.push(0); // shares
        row.push(0); // purchaseprice
        row.push("n/a"); // buydate
        row.push(0); // saleprice
        row.push("n/a"); // saledate
        row.push(0); // ForwardPE
        row.push(0); // ForwardEPS
        row.push(0); // TrailingAnnualDividendYield
        array.push(row);
        
        var data = google.visualization.arrayToDataTable(array);
        return data
      }

      function drawATable(title, id, data) {
        var options = {
          title: title
        };

        var table = new google.visualization.Table(document.getElementById(id));

        table.draw(data, {showRowNumber: true, width: '100%', height: '100%'});
      }

      function drawTable() {
        var value = {{.Pretaxes.Value}}
        var gain = {{.Pretaxes.Gain}}
        var percentage = {{.Pretaxes.Percentage}}
        drawATable("Components", "preTaxTable", createTableData({{ .Pretaxes.Positions }}, value, gain, percentage));

        value = {{.Posttaxes.Value}}
        gain = {{.Posttaxes.Gain}}
        percentage = {{.Posttaxes.Percentage}}
        drawATable("Components", "postTaxTable", createTableData({{ .Posttaxes.Positions }}, value, gain, percentage));
      }
    </script>
  </head>
  <body>
    <div id="preTaxTable"></div>
    <table class="columns">
      <tr>
        <td>
          <div id="preTaxHoldings" style="width: 900px; height: 500px;"></div>
        </td>
        <td>
          <div id="preTaxSectors" style="width: 900px; height: 500px;"></div>
        </td>
      </tr>
    </table>

    <div id="postTaxTable"></div>
    <table class="columns">
      <tr>
        <td>
          <div id="postTaxHoldings" style="width: 900px; height: 500px;"></div>
        </td>
        <td>
          <div id="postTaxSectors" style="width: 900px; height: 500px;"></div>
        </td>
      </tr>
    </table>
  </body>
</html>
